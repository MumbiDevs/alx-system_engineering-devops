#!/usr/bin/env bash
# This script configures Nginx to add a custom HTTP response header X-Served-By

# Update package list and install Nginx if not installed
apt-get update -y
apt-get install nginx -y

# Get the hostname of the server
HOSTNAME=$(hostname)

# Backup the default Nginx configuration file if it exists
if [ -f /etc/nginx/sites-available/default ]; then
    cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak
fi

# Create or update the Nginx configuration file
cat <<EOF > /etc/nginx/sites-available/default
server {
    listen 80;
    root /var/www/html;
    index index.html;

    location / {
        try_files \$uri \$uri/ =404;
    }

    # Add custom header
    add_header X-Served-By "$HOSTNAME";
}
EOF

# Test the Nginx configuration
nginx -t

# Restart Nginx to apply the new configuration
systemctl restart nginx

# Ensure Nginx starts on boot
systemctl enable nginx
